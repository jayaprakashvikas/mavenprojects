pipeline
{
environment {
    registry = "jayaprakashvikas/project1"
    registryCredential = 'dockerhub'
	def dockerImage = ''
}

agent any
tools{
maven 'maven 3'
jdk 'java 8'
}


    stages {       
	stage ("initialize") {
steps {
sh '''
echo "PATH = ${PATH}"
echo "M2_HOME = ${M2_HOME}"
'''
}
}
stage('Cloning Git') {
  steps {
    git 'https://github.com/jayaprakashvikas/mavenprojects.git'
  }
}

stage('Building image') {
      steps{
        script {
		
          sh "mvn clean package"
		  dockerImage = docker.build registry + ":$BUILD_NUMBER"
        }
      }
    }
	stage('Deploy Image') {
	
  steps{    script {
      docker.withRegistry( '', registryCredential ) {
	  dockerImage.push()
      }
    }
  }
}
}
}