pipeline
{
environment {
    registry = "jayaprakashvikas/project1"
    registryCredential = 'dockerhub'
	def dockerImage = ''
}
agent any
docker {
            image 'maven:3-alpine' 
            args '-v /root/.m2:/root/.m2' 
        }

    stages {       
stage('Cloning Git') {
  steps {
    git 'https://github.com/jayaprakashvikas/mavenprojects.git'
  }
}

stage('Building image') {
      steps{
        script {
		
          sh "mvn clean package"
		  dockerImage = docker.build registry + ":$BUILD_NUMBER"
        }
      }
    }
	stage('Deploy Image') {
	
  steps{    script {
      docker.withRegistry( '', registryCredential ) {
	  dockerImage.push()
      }
    }
  }
}
}
}